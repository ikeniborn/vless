{
  "version": "1.0",
  "description": "Known error patterns in HAProxy logs",

  "patterns": [
    {
      "id": "haproxy_backend_down",
      "regex": "Server.*is DOWN|backend.*has no server available",
      "severity": "CRITICAL",
      "category": "backend",
      "description": "Backend server unreachable or down",
      "recommendation": "Check backend container health (vless_xray, vless_nginx_reverseproxy)"
    },
    {
      "id": "haproxy_config_error",
      "regex": "parsing.*configuration.*failed|config.*error|fatal",
      "severity": "CRITICAL",
      "category": "configuration",
      "description": "HAProxy configuration syntax error",
      "recommendation": "Run 'haproxy -c -f haproxy.cfg' to validate config"
    },
    {
      "id": "haproxy_connection_refused",
      "regex": "Connection refused|connect\\(\\).*failed.*Connection refused",
      "severity": "HIGH",
      "category": "backend",
      "description": "Backend refusing connections",
      "recommendation": "Verify backend listening on correct port (xray:8443, nginx:9443-9452)"
    },
    {
      "id": "haproxy_timeout",
      "regex": "timeout.*server|server timeout",
      "severity": "MEDIUM",
      "category": "performance",
      "description": "Backend taking too long to respond",
      "recommendation": "Check backend performance, consider increasing timeout values"
    },
    {
      "id": "haproxy_ssl_handshake_fail",
      "regex": "SSL handshake failure|SSL_accept.*failed",
      "severity": "MEDIUM",
      "category": "tls",
      "description": "TLS handshake failure",
      "recommendation": "Check certificate validity, client TLS version compatibility"
    },
    {
      "id": "haproxy_acl_no_match",
      "regex": "no backend available|no server is available",
      "severity": "HIGH",
      "category": "routing",
      "description": "No ACL match for request, no backend selected",
      "recommendation": "Verify dynamic reverse proxy routes in haproxy.cfg"
    }
  ]
}
