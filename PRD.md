# Product Requirements Document (PRD)
## VLESS + REALITY VPN Service

### 1. Обзор проекта

**Название проекта:** VLESS + REALITY VPN Service
**Версия документа:** 1.0
**Дата:** 2025-09-26
**Тип проекта:** Личное использование
**Масштаб:** До 50 пользователей

### 2. Цель и задачи

#### 2.1 Цель проекта
Создание защищенного VPN сервиса на базе протокола VLESS с расширением REALITY для обхода DPI и блокировок, с простым CLI управлением и автоматизацией основных процессов.

#### 2.2 Основные задачи
- Развертывание Xray-core с поддержкой VLESS + REALITY в Docker
- Реализация CLI интерфейса для управления пользователями
- Автоматизация процессов установки и обновления
- Обеспечение простого администрирования через bash скрипты

### 3. Целевая аудитория

- **Основные пользователи:** Личное использование
- **Количество пользователей:** До 50
- **Технический уровень:** Средний опыт работы с Linux и Docker
- **Требования к интерфейсу:** CLI интерфейс

### 4. Функциональные требования

#### 4.1 Основные функции

##### 4.1.1 Установка и настройка
- Автоматическая установка через единый скрипт `install.sh`
- Генерация X25519 ключей для REALITY
- Создание базовой конфигурации Xray
- Проверка работоспособности после установки

##### 4.1.2 Управление пользователями
- Добавление новых пользователей (генерация UUID)
- Удаление существующих пользователей
- Просмотр списка активных пользователей
- Генерация клиентских конфигураций:
  - vless:// ссылки для быстрого импорта
  - JSON конфигурации для различных клиентов
  - QR-коды для мобильных устройств

##### 4.1.3 Обслуживание системы
- Автоматическое обновление Xray-core
- Резервное копирование конфигурации
- Просмотр и анализ логов через Docker
- Перезапуск сервиса при необходимости

#### 4.2 Ограничения (что НЕ входит в проект)
- Веб-интерфейс управления
- REST API
- Детальная статистика трафика по пользователям
- Графические дашборды и метрики
- Автоматическая ротация ключей
- Интеграция с внешними системами

### 5. Технические требования

#### 5.1 Системные требования
- **ОС:** Linux (Ubuntu 20.04+ / Debian 11+)
- **RAM:** Минимум 512 MB, рекомендуется 1 GB
- **CPU:** 1 vCPU
- **Диск:** 10 GB свободного места
- **Сеть:** Статический IP адрес, открытый порт 443

#### 5.2 Технологический стек
- **Контейнеризация:** Docker 24.x, Docker Compose 2.x
- **VPN движок:** Xray-core (последняя версия)
- **Скрипты:** Bash
- **Утилиты:** qrencode, jq, curl

#### 5.3 Структура проекта
```
vless/
├── docker-compose.yml          # Конфигурация Docker Compose
├── config/
│   ├── config.json.template    # Шаблон конфигурации Xray
│   └── config.json             # Рабочая конфигурация
├── scripts/
│   ├── install.sh              # Установка системы
│   ├── user-manager.sh         # Управление пользователями
│   ├── update.sh               # Обновление Xray-core
│   ├── backup.sh               # Резервное копирование
│   ├── logs.sh                 # Работа с логами
│   └── lib/
│       ├── colors.sh           # Цветной вывод в терминал
│       ├── utils.sh            # Вспомогательные функции
│       └── config.sh           # Работа с конфигурацией
├── data/
│   ├── users.json              # База данных пользователей
│   └── keys/                   # Криптографические ключи
├── backups/                    # Резервные копии
├── logs/                       # Логи приложения
├── docs/
│   ├── README.md               # Быстрый старт
│   ├── ADMIN_GUIDE.md          # Руководство администратора
│   └── TROUBLESHOOTING.md      # Решение проблем
└── .env.example                # Пример переменных окружения
```

### 6. Архитектура решения

#### 6.1 Компоненты системы

##### Docker контейнеры:
- **xray-server:** Основной контейнер с Xray-core
  - Image: teddysun/xray:latest
  - Порт: 443
  - Volumes: config, logs, data

##### Bash скрипты:
1. **install.sh** - Мастер установки
   - Проверка системных требований
   - Установка Docker и Docker Compose
   - Генерация ключей
   - Создание первичной конфигурации

2. **user-manager.sh** - Интерактивное меню управления
   - Добавление пользователя
   - Удаление пользователя
   - Показать список пользователей
   - Экспорт конфигурации пользователя

3. **update.sh** - Обновление Xray
   - Проверка новой версии
   - Безопасное обновление контейнера
   - Автоматический перезапуск

4. **backup.sh** - Резервное копирование
   - Сохранение конфигурации
   - Экспорт списка пользователей
   - Архивация ключей

5. **logs.sh** - Мониторинг
   - Просмотр логов в реальном времени
   - Фильтрация по уровню важности
   - Экспорт логов

#### 6.2 Конфигурация REALITY

```json
{
  "inbounds": [{
    "port": 443,
    "protocol": "vless",
    "settings": {
      "clients": [],
      "decryption": "none"
    },
    "streamSettings": {
      "network": "tcp",
      "security": "reality",
      "realitySettings": {
        "dest": "speed.cloudflare.com:443",
        "serverNames": ["speed.cloudflare.com"],
        "privateKey": "",
        "shortIds": [""]
      }
    }
  }]
}
```

### 7. План реализации

#### Этап 1: Базовая инфраструктура (2-3 дня)
- [x] Создание структуры проекта
- [ ] Написание docker-compose.yml
- [ ] Создание шаблона config.json
- [ ] Скрипт install.sh
- [ ] Генерация X25519 ключей
- [ ] Тестирование базового функционала

#### Этап 2: Управление пользователями (2-3 дня)
- [ ] Скрипт user-manager.sh
- [ ] Функции CRUD для пользователей
- [ ] Генерация UUID
- [ ] Создание vless:// ссылок
- [ ] Генерация QR-кодов
- [ ] Система хранения в users.json

#### Этап 3: Автоматизация (2 дня)
- [ ] Скрипт update.sh
- [ ] Скрипт backup.sh
- [ ] Скрипт logs.sh
- [ ] Настройка cron задач
- [ ] Библиотеки вспомогательных функций

#### Этап 4: Документация (1-2 дня)
- [ ] README.md с быстрым стартом
- [ ] ADMIN_GUIDE.md
- [ ] TROUBLESHOOTING.md
- [ ] Примеры использования
- [ ] FAQ

### 8. Безопасность

#### 8.1 Меры безопасности
- Использование REALITY для маскировки трафика
- Хранение ключей с ограниченными правами (600)
- Изоляция Docker контейнера
- Отсутствие открытых портов кроме 443
- Регулярное обновление Xray-core

#### 8.2 Рекомендации по использованию
- Выбор целевого сайта вне юрисдикции страны
- Использование сложных shortIds
- Регулярное резервное копирование
- Мониторинг логов на предмет аномалий

### 9. Критерии успеха

1. **Функциональность:**
   - Успешная установка за один запуск скрипта
   - Работающее подключение клиентов
   - Стабильная работа при 50 пользователях

2. **Удобство использования:**
   - Интуитивное CLI меню
   - Время добавления пользователя < 1 минуты
   - Автоматическая генерация всех форматов конфигураций

3. **Надежность:**
   - Автоматическое восстановление после сбоев
   - Успешное обновление без потери конфигурации
   - Работоспособные резервные копии

### 10. Риски и митигация

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Блокировка целевого сайта | Средняя | Высокое | Список альтернативных сайтов |
| Обнаружение VPN трафика | Низкая | Высокое | Регулярное обновление Xray |
| Потеря конфигурации | Низкая | Среднее | Автоматические бэкапы |
| Сложность для пользователя | Средняя | Низкое | Подробная документация |

### 11. Поддержка и обслуживание

#### 11.1 Регулярное обслуживание
- Еженедельная проверка обновлений Xray-core
- Ежемесячное резервное копирование
- Мониторинг логов на ошибки

#### 11.2 Документация для администратора
- Пошаговая инструкция установки
- Руководство по управлению пользователями
- Часто встречающиеся проблемы и решения
- Процедуры восстановления

### 12. Будущие улучшения (вне текущего scope)

Возможные расширения функциональности в будущем:
- Веб-интерфейс управления
- REST API для автоматизации
- Интеграция с Telegram ботом
- Детальная статистика использования
- Поддержка множественных серверов
- Автоматический failover

---

## Заключение

Данный PRD описывает создание функционального VPN сервиса на базе VLESS + REALITY с фокусом на простоту управления через CLI, надежность работы и легкость администрирования. Решение оптимизировано для личного использования с поддержкой до 50 пользователей и не требует глубоких технических знаний для повседневного управления.

**Статус документа:** Утвержден
**Готовность к реализации:** Да
**Ориентировочные сроки:** 7-10 дней