# –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ HTTPS –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ stunnel + xray

**–î–∞—Ç–∞:** 2025-10-07
**–¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥–∞:** `curl -v --proxy https://proxy:9068b5ca600dd5c4a731562bf3685898@proxy-dev.ikeniborn.ru:8118 https://ifconfig.me`

---

## 1. –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê #1: Xray –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è stunnel

**–°–∏–º–ø—Ç–æ–º—ã:**
```
stunnel LOG: s_connect: connect 172.20.0.2:18118: Connection refused (111)
curl error: Send failure: Connection reset by peer
```

**–ü—Ä–∏—á–∏–Ω–∞:**
Xray —Å–ª—É—à–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –ø–æ—Ä—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞ localhost (127.0.0.1) –≤–Ω—É—Ç—Ä–∏ —Å–≤–æ–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω–æ stunnel –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ Docker network (172.20.0.2).

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:**

1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è xray (xray_config.json):**
```json
{
  "port": 10800,
  "protocol": "socks",
  "listen": "127.0.0.1"  ‚Üê –ü–†–û–ë–õ–ï–ú–ê: localhost only
}
{
  "port": 18118,
  "protocol": "http",
  "listen": "127.0.0.1"  ‚Üê –ü–†–û–ë–õ–ï–ú–ê: localhost only
}
```

2. **–°–µ—Ç–µ–≤–æ–π —Å—Ç–∞—Ç—É—Å –≤–Ω—É—Ç—Ä–∏ xray:**
```
tcp    0    0 127.0.0.1:10800    0.0.0.0:*    LISTEN
tcp    0    0 127.0.0.1:18118    0.0.0.0:*    LISTEN
         ‚Üë
    –°–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ localhost
```

3. **Docker network —Ç–æ–ø–æ–ª–æ–≥–∏—è:**
```
stunnel:  172.20.0.4  ‚Üí –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫
xray:     172.20.0.2:10800/18118  ‚Üê –Ω–æ –ø–æ—Ä—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã:**
- `127.0.0.1` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ xray != `172.20.0.2` –≤ Docker network
- stunnel (–∏–∑ –¥—Ä—É–≥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞) –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ localhost xray
- Connection refused (111) - –ø–æ—Ä—Ç –Ω–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –≤–Ω–µ—à–Ω–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

---

### üü° –û–®–ò–ë–ö–ê #2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å curl –¥–ª—è TLS-wrapped –ø—Ä–æ–∫—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
```bash
curl -v --proxy https://proxy:PASSWORD@proxy-dev.ikeniborn.ru:8118 https://ifconfig.me
                    ‚Üë
               –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
```

**–ü—Ä–∏—á–∏–Ω–∞:**
`--proxy https://...` –≥–æ–≤–æ—Ä–∏—Ç curl –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS CONNECT –º–µ—Ç–æ–¥, –Ω–æ:
- stunnel –¥–µ–ª–∞–µ—Ç **TLS termination** (—Å–Ω–∏–º–∞–µ—Ç TLS –Ω–∞ –≤—Ö–æ–¥–µ)
- –ü–æ—Å–ª–µ TLS - –æ–±—ã—á–Ω—ã–π plaintext HTTP –ø—Ä–æ–∫—Å–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª
- curl –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å plaintext HTTP CONNECT –≤–Ω—É—Ç—Ä–∏ TLS —Ç—É–Ω–Ω–µ–ª—è

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**
```bash
curl -v --proxy http://proxy:PASSWORD@proxy-dev.ikeniborn.ru:8118 https://ifconfig.me
                   ‚Üë
            –ò—Å–ø–æ–ª—å–∑—É–π http:// –¥–∞–∂–µ –¥–ª—è TLS-wrapped –ø—Ä–æ–∫—Å–∏
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. curl —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç TLS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å proxy-dev.ikeniborn.ru:8118
2. stunnel –ø—Ä–∏–Ω–∏–º–∞–µ—Ç TLS, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
3. curl –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **plaintext** HTTP CONNECT –≤–Ω—É—Ç—Ä–∏ TLS —Ç—É–Ω–Ω–µ–ª—è
4. stunnel —Ñ–æ—Ä–≤–∞—Ä–¥–∏—Ç plaintext –∫ xray:18118
5. xray –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP CONNECT

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (SOCKS5):**
```bash
curl -v --proxy socks5://proxy:PASSWORD@proxy-dev.ikeniborn.ru:1080 https://ifconfig.me
                   ‚Üë
              SOCKS5 —á–µ—Ä–µ–∑ TLS (stunnel –Ω–∞ –ø–æ—Ä—Ç—É 1080)
```

---

### üîµ –û–®–ò–ë–ö–ê #3: Health check —à—É–º –≤ –ª–æ–≥–∞—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
```
stunnel LOG: SSL_accept: error:0A000126:SSL routines::unexpected eof while reading
stunnel LOG: Connection reset/closed: 0 byte(s) sent to TLS, 0 byte(s) sent to socket
```
–ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –æ—Ç 127.0.0.1

**–ü—Ä–∏—á–∏–Ω–∞:**
Docker Compose healthcheck –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ø–æ—Ä—Ç–∞–º 1080/8118, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –æ–Ω–∏ —Å–ª—É—à–∞—é—Ç, –∏ —Å—Ä–∞–∑—É –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. healthcheck –¥–µ–ª–∞–µ—Ç TCP connect –∫ –ø–æ—Ä—Ç—É
2. stunnel –Ω–∞—á–∏–Ω–∞–µ—Ç TLS handshake (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Server Hello)
3. healthcheck –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—è Client Hello)
4. stunnel –ª–æ–≥–∏—Ä—É–µ—Ç "unexpected eof while reading"

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π
- –ú–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å debug level –≤ stunnel.conf (debug = 3 –≤–º–µ—Å—Ç–æ 5)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∏–∑–º–µ–Ω–∏—Ç—å healthcheck –Ω–∞ `nc -z` (–±–µ–∑ TLS)

---

## 2. –í–ê–†–ò–ê–ù–¢–´ –†–ï–®–ï–ù–ò–Ø

### ‚úÖ –†–ï–®–ï–ù–ò–ï #1 (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø): –ò–∑–º–µ–Ω–∏—Ç—å listen –∞–¥—Ä–µ—Å –≤ xray

**–î–µ–π—Å—Ç–≤–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å `listen: "127.0.0.1"` –Ω–∞ `listen: "0.0.0.0"` –¥–ª—è –ø—Ä–æ–∫—Å–∏ inbound'–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```bash
# –ù–∞–π—Ç–∏ –∏ –∏–∑–º–µ–Ω–∏—Ç—å xray_config.json
docker exec vless_xray cat /etc/xray/xray_config.json | \
  jq '(.inbounds[] | select(.port == 10800 or .port == 18118) | .listen) = "0.0.0.0"' \
  > /opt/vless/config/xray_config.json

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å xray
docker restart vless_xray
```

**–§–∞–π–ª:** `/opt/vless/config/xray_config.json` –∏–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞

**–ë—ã–ª–æ:**
```json
{
  "port": 10800,
  "protocol": "socks",
  "listen": "127.0.0.1"
}
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```json
{
  "port": 10800,
  "protocol": "socks",
  "listen": "0.0.0.0"
}
```

**–ü–æ—á–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ:**
- –ü–æ—Ä—Ç—ã 10800/18118 **–Ω–µ exposed** –≤ docker-compose.yml (–Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ —Ö–æ—Å—Ç–∞)
- –î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker network vless_reality_net
- stunnel - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ stunnel TLS + xray password)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
docker exec vless_xray netstat -tuln | grep -E "(10800|18118)"
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# tcp  0  0  0.0.0.0:10800  0.0.0.0:*  LISTEN
# tcp  0  0  0.0.0.0:18118  0.0.0.0:*  LISTEN

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–∑ stunnel
docker exec vless_stunnel nc -zv vless_xray 10800
docker exec vless_stunnel nc -zv vless_xray 18118
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: Connection to vless_xray 10800/18118 port [tcp] succeeded!
```

---

### ‚úÖ –†–ï–®–ï–ù–ò–ï #2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å curl –∫–æ–º–∞–Ω–¥—É

**–ë—ã–ª–æ:**
```bash
curl -v --proxy https://proxy:PASSWORD@proxy-dev.ikeniborn.ru:8118 https://ifconfig.me
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å (HTTP –ø—Ä–æ–∫—Å–∏):**
```bash
curl -v --proxy http://proxy:9068b5ca600dd5c4a731562bf3685898@proxy-dev.ikeniborn.ru:8118 https://ifconfig.me
```

**–ò–ª–∏ (SOCKS5 –ø—Ä–æ–∫—Å–∏):**
```bash
curl -v --proxy socks5://proxy:9068b5ca600dd5c4a731562bf3685898@proxy-dev.ikeniborn.ru:1080 https://ifconfig.me
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- `http://` –≤ --proxy –æ–∑–Ω–∞—á–∞–µ—Ç "HTTP CONNECT –º–µ—Ç–æ–¥" (–Ω–µ HTTPS)
- TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è stunnel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- curl —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç TLS –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ, –∞ –ø—Ä–æ—Ç–æ–∫–æ–ª –ø—Ä–æ–∫—Å–∏ - HTTP

---

### ‚ö†Ô∏è –†–ï–®–ï–ù–ò–ï #3 (–ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø): –†–∞–∑–º–µ—Å—Ç–∏—Ç—å stunnel –∏ xray –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**–ò–¥–µ—è:** –£–±—Ä–∞—Ç—å Docker network hop, stunnel –∏ xray –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Üí localhost —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ú–∏–Ω—É—Å—ã:**
- –£—Å–ª–æ–∂–Ω—è–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (–æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä - –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞)
- –ù—É–∂–µ–Ω supervisor (stunnel + xray –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- –°–ª–æ–∂–Ω–µ–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ù–∞—Ä—É—à–∞–µ—Ç Docker best practice (one process per container)

**–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**, —Ä–µ—à–µ–Ω–∏–µ #1 –ø—Ä–æ—â–µ –∏ —á–∏—â–µ.

---

## 3. –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (PRIORITY ORDER)

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å xray listen –∞–¥—Ä–µ—Å–∞ (–ö–†–ò–¢–ò–ß–ù–û)
```bash
# 1. –ù–∞–π—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ xray_config.json
#    –í–µ—Ä–æ—è—Ç–Ω–æ –≤ /opt/vless/scripts/generate_config.sh –∏–ª–∏ –ø–æ—Ö–æ–∂–µ–º

# 2. –ò–∑–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω —Å 127.0.0.1 –Ω–∞ 0.0.0.0 –¥–ª—è proxy inbounds

# 3. –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å xray
docker restart vless_xray

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
docker exec vless_xray netstat -tuln | grep -E "(10800|18118)"
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å curl —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º
```bash
# HTTP –ø—Ä–æ–∫—Å–∏
curl -v --proxy http://proxy:9068b5ca600dd5c4a731562bf3685898@proxy-dev.ikeniborn.ru:8118 https://ifconfig.me

# SOCKS5 –ø—Ä–æ–∫—Å–∏
curl -v --proxy socks5://proxy:9068b5ca600dd5c4a731562bf3685898@proxy-dev.ikeniborn.ru:1080 https://ifconfig.me
```

### –®–∞–≥ 3: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –£–º–µ–Ω—å—à–∏—Ç—å –ª–æ–≥ —à—É–º –æ—Ç healthcheck
```bash
# –í stunnel.conf –∏–∑–º–µ–Ω–∏—Ç—å:
debug = 5  ‚Üí  debug = 3

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å healthcheck –≤ docker-compose.yml –Ω–∞ nc -z
```

---

## 4. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–ë–õ–Æ–î–ï–ù–ò–Ø

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **TLS —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è stunnel:**
   - –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–Ω—ã–π (Let's Encrypt)
   - TLSv1.3 —Ä–∞–±–æ—Ç–∞–µ—Ç
   - Cipher suite: TLS_AES_256_GCM_SHA384 ‚úì

2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
   - User: proxy
   - Pass: 9068b5ca600dd5c4a731562bf3685898
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ xray –¥–ª—è –æ–±–æ–∏—Ö –ø—Ä–æ–∫—Å–∏ ‚úì

3. **Docker network:**
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ (vless_reality_net)
   - DNS —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è (vless_xray ‚Üí 172.20.0.2) ‚úì

### ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **Network binding:**
   - Xray –ø—Ä–æ–∫—Å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ Docker network
   - stunnel –Ω–µ –º–æ–∂–µ—Ç —Ñ–æ—Ä–≤–∞—Ä–¥–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫

2. **curl —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `https://` –≤–º–µ—Å—Ç–æ `http://` –≤ --proxy

---

## 5. –ü–†–û–í–ï–†–û–ß–ù–´–ï –ö–û–ú–ê–ù–î–´

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ xray —Å–ª—É—à–∞–µ—Ç –Ω–∞ 0.0.0.0
docker exec vless_xray netstat -tuln | grep -E "(10800|18118)"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å connectivity –∏–∑ stunnel
docker exec vless_stunnel nc -zv vless_xray 10800
docker exec vless_stunnel nc -zv vless_xray 18118

# 3. –¢–µ—Å—Ç HTTP –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ curl
curl -v --proxy http://proxy:9068b5ca600dd5c4a731562bf3685898@proxy-dev.ikeniborn.ru:8118 https://ifconfig.me

# 4. –¢–µ—Å—Ç SOCKS5 –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ curl
curl -v --proxy socks5://proxy:9068b5ca600dd5c4a731562bf3685898@proxy-dev.ikeniborn.ru:1080 https://ifconfig.me

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ stunnel (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å Connection refused)
docker logs vless_stunnel --tail 20 | grep -i "refused"

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ xray (–¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è accepted connections)
docker logs vless_xray --tail 20
```

---

## 6. –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### curl –≤—ã–≤–æ–¥ (—É—Å–ø–µ—à–Ω—ã–π):
```
* Connected to proxy-dev.ikeniborn.ru (205.172.58.179) port 8118
* ALPN: curl offers http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384
* CONNECT tunnel: HTTP/1.1 negotiated
* Establish HTTP proxy tunnel to ifconfig.me:443
> CONNECT ifconfig.me:443 HTTP/1.1
> Proxy-Authorization: Basic cHJveHk6OTA2OGI1Y2E2MDBkZDVjNGE3MzE1NjJiZjM2ODU4OTg=
< HTTP/1.1 200 Connection established
* CONNECT phase completed
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* Connected to ifconfig.me
> GET / HTTP/1.1
> Host: ifconfig.me
< HTTP/1.1 200 OK
205.172.58.179  ‚Üê IP –∞–¥—Ä–µ—Å VPN —Å–µ—Ä–≤–µ—Ä–∞
```

### stunnel –ª–æ–≥ (—É—Å–ø–µ—à–Ω—ã–π):
```
LOG5: Service [http-tls] accepted connection from 172.20.0.1:12345
LOG6: s_connect: connected 172.20.0.2:18118
LOG6: TLS accepted: new session negotiated
LOG5: Connection closed: 1234 byte(s) sent to TLS, 5678 byte(s) sent to socket
```

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è network –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è xray (listen –Ω–∞ localhost –≤–º–µ—Å—Ç–æ 0.0.0.0)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (–ø—Ä–æ–∫—Å–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ—Ä–∞–±–æ—á–∏–π)

**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** ~5 –º–∏–Ω—É—Ç (–∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ + –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)

**–†–∏—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ (–ø–æ—Ä—Ç—ã –Ω–µ exposed –Ω–∞—Ä—É–∂—É, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ internal network binding)
