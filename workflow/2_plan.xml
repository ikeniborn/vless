<?xml version="1.0" encoding="UTF-8"?>
<plan>
    <tasks>
        <task id="1" priority="HIGH">
            <description>Fix jq command in utils.sh line 306 for Docker network check</description>
            <location>scripts/lib/utils.sh:306</location>
            <changes>
                <change>Add null/type checking to prevent startswith() error on non-string values</change>
                <change>Ensure .IPAM.Config[0].Subnet is a string before applying startswith()</change>
            </changes>
            <validation>
                - No jq errors when checking Docker networks
                - Proper handling of networks without subnet configuration
            </validation>
        </task>

        <task id="2" priority="HIGH">
            <description>Fix xray config validation in utils.sh line 204</description>
            <location>scripts/lib/utils.sh:204-210</location>
            <changes>
                <change>Replace incorrect 'xray test' command with proper validation method</change>
                <change>Use 'xray run -test' or JSON validation as alternative</change>
            </changes>
            <validation>
                - No "unknown command" error
                - Config validation works or gracefully skips
            </validation>
        </task>

        <task id="3" priority="MEDIUM">
            <description>Update install.sh troubleshooting command</description>
            <location>scripts/install.sh:361</location>
            <changes>
                <change>Update troubleshooting command to match utils.sh fix</change>
            </changes>
            <validation>
                - Troubleshooting command is correct
            </validation>
        </task>

        <task id="4" priority="HIGH">
            <description>Test all fixes</description>
            <location>N/A</location>
            <changes>
                <change>Run start script to verify no errors</change>
                <change>Ensure service functions correctly</change>
            </changes>
            <validation>
                - Clean startup without jq or xray errors
                - Service runs successfully
            </validation>
        </task>
    </tasks>

    <execution_order>
        <step order="1" task_id="1">Fix jq command for Docker network check</step>
        <step order="2" task_id="2">Fix xray config validation command</step>
        <step order="3" task_id="3">Update troubleshooting documentation</step>
        <step order="4" task_id="4">Test all fixes</step>
    </execution_order>

    <dependencies>
        <dependency>
            <task_id>3</task_id>
            <depends_on>2</depends_on>
            <reason>Troubleshooting command depends on xray validation fix</reason>
        </dependency>
        <dependency>
            <task_id>4</task_id>
            <depends_on>1,2,3</depends_on>
            <reason>Testing requires all fixes to be implemented</reason>
        </dependency>
    </dependencies>
</plan>