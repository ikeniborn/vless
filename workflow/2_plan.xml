<?xml version="1.0" encoding="UTF-8"?>
<plan>
    <tasks>
        <task id="1" priority="HIGH">
            <description>Модифицировать функцию check_system_requirements в lib/utils.sh</description>
            <location>scripts/lib/utils.sh:224-252</location>
            <changes>
                <change>Изменить print_error на print_warning для проверки дискового пространства (строка 247)</change>
                <change>Не увеличивать счетчик errors при недостатке места (строка 248)</change>
                <change>Добавить информативное сообщение о последствиях недостатка места</change>
                <change>Опционально: добавить запрос подтверждения продолжения установки</change>
            </changes>
            <validation>
                - Функция не возвращает ошибку при недостатке места
                - Выводится предупреждение вместо ошибки
                - Проверка RAM остается неизменной
            </validation>
        </task>

        <task id="2" priority="MEDIUM">
            <description>Добавить дополнительную проверку с подтверждением пользователя</description>
            <location>scripts/lib/utils.sh:246-249</location>
            <changes>
                <change>После вывода предупреждения запросить подтверждение продолжения</change>
                <change>Использовать функцию confirm_action для запроса</change>
            </changes>
            <validation>
                - При отказе пользователя установка прерывается
                - При согласии установка продолжается
            </validation>
        </task>

        <task id="3" priority="LOW">
            <description>Проверить и обновить PRD.md при необходимости</description>
            <location>PRD.md</location>
            <changes>
                <change>Проверить соответствие изменений требованиям PRD</change>
                <change>Обновить документацию если требуется</change>
            </changes>
            <validation>
                - Изменения соответствуют PRD
            </validation>
        </task>
    </tasks>

    <execution_order>
        <step order="1" task_id="1">Модифицировать check_system_requirements</step>
        <step order="2" task_id="2">Добавить подтверждение пользователя</step>
        <step order="3" task_id="3">Проверить PRD.md</step>
    </execution_order>

    <dependencies>
        <dependency>
            <task_id>2</task_id>
            <depends_on>1</depends_on>
            <reason>Подтверждение добавляется после основной модификации</reason>
        </dependency>
        <dependency>
            <task_id>3</task_id>
            <depends_on>1,2</depends_on>
            <reason>Документация проверяется после всех изменений</reason>
        </dependency>
    </dependencies>

    <implementation_details>
        <detail>
            <aspect>Изменение проверки дискового пространства</aspect>
            <current_code><![CDATA[
    # Check disk space (minimum 5GB in /opt)
    local free_space=$(df -BG /opt 2>/dev/null | awk 'NR==2{print int($4)}')
    if [ -z "$free_space" ] || [ $free_space -lt 5 ]; then
        print_error "Insufficient disk space. Minimum 5GB required in /opt"
        ((errors++))
    fi
            ]]></current_code>
            <new_code><![CDATA[
    # Check disk space (minimum 5GB in /opt)
    local free_space=$(df -BG /opt 2>/dev/null | awk 'NR==2{print int($4)}')
    if [ -z "$free_space" ] || [ $free_space -lt 5 ]; then
        print_warning "Insufficient disk space. Minimum 5GB recommended in /opt (found: ${free_space}GB)"
        print_info "Installation can continue, but you may experience issues with:"
        print_info "  - Docker container storage"
        print_info "  - Log file accumulation"
        print_info "  - Backup creation"

        if ! confirm_action "Do you want to continue despite low disk space?" "n"; then
            print_error "Installation cancelled by user due to low disk space"
            ((errors++))
        else
            print_info "Continuing installation with low disk space warning"
        fi
    fi
            ]]></new_code>
        </detail>
    </implementation_details>
</plan>