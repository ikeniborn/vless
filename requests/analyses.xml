<?xml version="1.0" encoding="UTF-8"?>
<analysis>
    <context>
        <project>VLESS+Reality VPN</project>
        <technologies>
            <language>Bash</language>
            <language>Python</language>
            <infrastructure>Docker Compose</infrastructure>
            <vpn>Xray-core with VLESS+Reality protocol</vpn>
        </technologies>
    </context>

    <problem>
        <description>Переменная WHITE не определена при выполнении install.sh</description>
        <location>
            <file>/home/ikeniborn/Documents/Project/vless/modules/common_utils.sh</file>
            <line>57</line>
        </location>
        <error_message>WHITE: unbound variable</error_message>
        <root_cause>
            <item>Используется режим set -euo pipefail, который прерывает выполнение при обращении к неопределенным переменным</item>
            <item>Переменные цветов определяются условно (строки 28-38), проверяя только RED</item>
            <item>Если RED уже определена, блок пропускается, но WHITE может быть не определена</item>
            <item>В функции print_header на строке 57 происходит обращение к неопределенной WHITE</item>
        </root_cause>
    </problem>

    <solution>
        <approach>Исправить условную проверку определения цветовых переменных</approach>
        <steps>
            <step number="1">Изменить проверку с RED на WHITE или проверять все переменные</step>
            <step number="2">Использовать параметр подстановки по умолчанию ${WHITE:-}</step>
            <step number="3">Убедиться, что все цветовые переменные определены корректно</step>
        </steps>
    </solution>

    <testing_plan>
        <test number="1">Проверить корректность определения всех цветовых переменных</test>
        <test number="2">Запустить install.sh для проверки исправления</test>
        <test number="3">Проверить работу всех функций вывода (print_header, print_info и т.д.)</test>
    </testing_plan>
</analysis>