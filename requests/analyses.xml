<?xml version="1.0" encoding="UTF-8"?>
<analysis>
    <project>VLESS+Reality VPN Management System</project>
    <date>2025-09-23</date>
    <version>1.1.0</version>

    <phase5_overview>
        <description>Phase 5 implements advanced features including Telegram bot integration, web dashboard (planned), and advanced maintenance utilities</description>
        <status>Currently implemented but redundant for the project</status>
        <reason_for_removal>Telegram integration adds unnecessary complexity and dependencies without significant value for VPN management</reason_for_removal>
    </phase5_overview>

    <affected_files>
        <file_group name="Telegram Bot Files">
            <file path="/modules/telegram_bot.py" description="Main Telegram bot implementation"/>
            <file path="/modules/telegram_bot_manager.sh" description="Bot management wrapper script"/>
            <file path="/deploy_telegram_bot.sh" description="Bot deployment script"/>
            <file path="/config/bot_config.env" description="Bot configuration template"/>
        </file_group>

        <file_group name="Phase 5 Core Files">
            <file path="/install.sh" description="Main installer with Phase 5 implementation"/>
            <file path="/modules/safety_utils.sh" description="Contains Phase 5 configuration profiles"/>
        </file_group>

        <file_group name="Documentation">
            <file path="/docs/installation.md" description="Contains Phase 5 documentation"/>
            <file path="/docs/user_guide.md" description="Contains Telegram bot usage instructions"/>
            <file path="/docs/api_reference.md" description="Contains Telegram bot API documentation"/>
            <file path="/docs/troubleshooting.md" description="Contains bot troubleshooting sections"/>
            <file path="/CLAUDE.md" description="Project memory with Phase 5 references"/>
            <file path="/README.md" description="Project overview with Phase 5 mentions"/>
        </file_group>

        <file_group name="Tests">
            <file path="/tests/run_all_tests.sh" description="Master test runner with Phase 5 tests"/>
            <file path="/tests/test_installation_modes.sh" description="Tests installation profiles including Phase 5"/>
            <file path="/tests/run_optimization_tests.sh" description="Tests Phase 5 optimization"/>
            <file path="/tests/test_installation_fixes.sh" description="Tests Phase 5 fixes"/>
        </file_group>

        <file_group name="Dependencies">
            <file path="/requirements.txt" description="Python dependencies including Telegram bot libraries"/>
            <file path="/config/docker-compose.yml" description="May contain bot service definitions"/>
        </file_group>
    </affected_files>

    <dependencies_analysis>
        <python_dependencies>
            <package name="python-telegram-bot" usage="Core bot functionality"/>
            <package name="aiogram" usage="Alternative bot framework (if used)"/>
            <package name="python-dotenv" usage="Environment variable loading for bot"/>
        </python_dependencies>

        <system_dependencies>
            <dependency name="Docker" impact="Bot container if containerized"/>
            <dependency name="systemd" impact="Bot service management"/>
        </system_dependencies>

        <configuration_dependencies>
            <config name="INSTALLATION_MODE" values="minimal|balanced|full" impact="Controls Phase 5 execution"/>
            <config name="INSTALL_TELEGRAM_BOT" values="true|false|prompt" impact="Controls bot installation"/>
            <config name="TELEGRAM_BOT_TOKEN" impact="Bot authentication"/>
            <config name="TELEGRAM_ADMIN_ID" impact="Bot admin access"/>
        </configuration_dependencies>
    </dependencies_analysis>

    <code_references>
        <reference file="install.sh" line="41" description="Phase 5 constant definition"/>
        <reference file="install.sh" function="install_phase5" description="Main Phase 5 installation function"/>
        <reference file="install.sh" function="select_installation_mode" description="Phase 5 configuration based on mode"/>
        <reference file="install.sh" function="configure_installation_profile" description="Sets Phase 5 variables"/>
        <reference file="safety_utils.sh" function="configure_installation_profile" description="Configures INSTALL_TELEGRAM_BOT variable"/>
    </code_references>

    <impact_assessment>
        <positive_impacts>
            <impact>Reduces system complexity by removing unnecessary Telegram integration</impact>
            <impact>Removes Python dependencies reducing attack surface</impact>
            <impact>Simplifies maintenance and updates</impact>
            <impact>Reduces resource usage (no bot process running)</impact>
            <impact>Eliminates need for Telegram API tokens and configuration</impact>
        </positive_impacts>

        <negative_impacts>
            <impact>Loss of remote management via Telegram (minimal impact as SSH access remains)</impact>
            <impact>Need to update documentation to remove bot references</impact>
            <impact>Need to update tests to remove Phase 5 testing</impact>
        </negative_impacts>
    </impact_assessment>

    <removal_strategy>
        <step number="1" description="Remove Telegram bot files completely"/>
        <step number="2" description="Update install.sh to skip Phase 5 or reduce it to backup/maintenance only"/>
        <step number="3" description="Update installation modes to exclude Telegram references"/>
        <step number="4" description="Clean Python dependencies from requirements.txt"/>
        <step number="5" description="Update all documentation to remove bot references"/>
        <step number="6" description="Update tests to exclude Phase 5 testing"/>
        <step number="7" description="Update CLAUDE.md project memory"/>
        <step number="8" description="Keep backup_restore.sh and maintenance_utils.sh as they are useful"/>
    </removal_strategy>

    <preserved_features>
        <feature name="backup_restore.sh" reason="Essential for system backup and recovery"/>
        <feature name="maintenance_utils.sh" reason="Useful for system maintenance tasks"/>
        <feature name="Phase 4 Security" reason="Critical for system security"/>
        <feature name="Installation modes" reason="Useful for different deployment scenarios"/>
    </preserved_features>
</analysis>