<?xml version="1.0" encoding="UTF-8"?>
<plan>
    <metadata>
        <stage>Stage 5: Service Functions</stage>
        <created>2025-01-25T14:35:00Z</created>
        <priority>High</priority>
    </metadata>

    <tasks>
        <task id="1" priority="1">
            <name>Implement show_help function</name>
            <description>Create comprehensive help display</description>
            <location>vless-manager.sh</location>
            <position>After parse_arguments function</position>
            <implementation>
                <step>Create show_help() function</step>
                <step>Group commands by category</step>
                <step>Add descriptions and examples</step>
                <step>Use colored output</step>
            </implementation>
        </task>

        <task id="2" priority="2">
            <name>Implement backup_service function</name>
            <description>Create backup archive functionality</description>
            <location>vless-manager.sh</location>
            <position>After service management functions</position>
            <implementation>
                <step>Create backup_service() function</step>
                <step>Generate timestamped archive name</step>
                <step>Check for required files/directories</step>
                <step>Create tar.gz archive</step>
                <step>Report backup location and size</step>
            </implementation>
        </task>

        <task id="3" priority="3">
            <name>Implement uninstall_service function</name>
            <description>Complete service removal with safety checks</description>
            <location>vless-manager.sh</location>
            <position>After backup_service function</position>
            <implementation>
                <step>Create uninstall_service() function</step>
                <step>Add confirmation prompt</step>
                <step>Offer backup option</step>
                <step>Stop and remove container</step>
                <step>Remove Docker image</step>
                <step>Delete project directories</step>
                <step>Clean up configuration files</step>
            </implementation>
        </task>

        <task id="4" priority="4">
            <name>Update main function</name>
            <description>Add help and uninstall command handlers</description>
            <location>vless-manager.sh main()</location>
            <implementation>
                <step>Add "help" case handler</step>
                <step>Add "uninstall" case handler</step>
                <step>Update default case to show help</step>
            </implementation>
        </task>

        <task id="5" priority="5">
            <name>Create test file</name>
            <description>Comprehensive tests for service functions</description>
            <location>tests/test_service_functions.sh</location>
            <implementation>
                <step>Create test file structure</step>
                <step>Add help command tests</step>
                <step>Add backup function tests</step>
                <step>Add uninstall function tests</step>
                <step>Mock dangerous operations</step>
            </implementation>
        </task>

        <task id="6" priority="6">
            <name>Update existing tests</name>
            <description>Add service function tests to run_all_tests.sh</description>
            <location>tests/run_all_tests.sh</location>
            <implementation>
                <step>Register test_service_functions.sh</step>
                <step>Update test count</step>
            </implementation>
        </task>

        <task id="7" priority="7">
            <name>Execute tests</name>
            <description>Run all tests to verify implementation</description>
            <implementation>
                <step>Run test_service_functions.sh</step>
                <step>Run full test suite</step>
                <step>Fix any failures</step>
            </implementation>
        </task>

        <task id="8" priority="8">
            <name>Update documentation</name>
            <description>Update project documentation</description>
            <implementation>
                <step>Update CLAUDE.md with new functions</step>
                <step>Update README.md with uninstall instructions</step>
                <step>Mark Stage 5 as completed in PLAN.md</step>
            </implementation>
        </task>
    </tasks>

    <code_locations>
        <location>
            <file>vless-manager.sh</file>
            <line_after>2948</line_after>
            <description>Add show_help, backup_service, uninstall_service functions</description>
        </location>
        <location>
            <file>vless-manager.sh</file>
            <line>2957</line>
            <description>Update main() function with new commands</description>
        </location>
    </code_locations>

    <estimated_time>2 hours</estimated_time>

    <dependencies>
        <dependency>Existing Docker functions</dependency>
        <dependency>Logging functions</dependency>
        <dependency>Color output functions</dependency>
    </dependencies>

    <validation>
        <check>Help command displays all commands correctly</check>
        <check>Backup creates valid archive</check>
        <check>Uninstall removes all components</check>
        <check>Tests pass successfully</check>
        <check>Documentation is complete</check>
    </validation>
</plan>