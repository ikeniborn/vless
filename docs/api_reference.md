# API Reference - VLESS+Reality VPN

> –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ API, —Ñ—É–Ω–∫—Ü–∏—è–º –∏ –º–æ–¥—É–ª—è–º —Å–∏—Å—Ç–µ–º—ã VLESS+Reality VPN.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ú–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã](#–º–æ–¥—É–ª–∏-—Å–∏—Å—Ç–µ–º—ã)
2. [Telegram Bot API](#telegram-bot-api)
3. [–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏](#–º–æ–¥—É–ª—å-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
4. [–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏](#–º–æ–¥—É–ª—å-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏)
5. [–ú–æ–¥—É–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞](#–º–æ–¥—É–ª—å-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
6. [–ú–æ–¥—É–ª—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è](#–º–æ–¥—É–ª—å-—Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)
7. [–ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–º–æ–¥—É–ª—å-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
8. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ-—Ñ–∞–π–ª—ã)
9. [API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)

## üîß –ú–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

```
modules/
‚îú‚îÄ‚îÄ common_utils.sh              # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ system_update.sh             # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ docker_setup.sh              # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
‚îú‚îÄ‚îÄ ufw_config.sh                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–ª–∞
‚îú‚îÄ‚îÄ backup_restore.sh            # –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ user_management.sh           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îú‚îÄ‚îÄ cert_management.sh           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
‚îú‚îÄ‚îÄ telegram_bot.py              # Telegram –±–æ—Ç
‚îú‚îÄ‚îÄ telegram_bot_manager.sh      # –ú–µ–Ω–µ–¥–∂–µ—Ä –±–æ—Ç–∞
‚îú‚îÄ‚îÄ security_hardening.sh        # –£—Å–∏–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ logging_setup.sh             # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ monitoring.sh                # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ maintenance_utils.sh         # –£—Ç–∏–ª–∏—Ç—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ process_isolation/           # –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    ‚îî‚îÄ‚îÄ process_safe.sh
```

### –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (common_utils.sh)

#### print_status()
–í—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

```bash
print_status "message" "status"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `message` - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `status` - –°—Ç–∞—Ç—É—Å: `info`, `success`, `warning`, `error`

**–ü—Ä–∏–º–µ—Ä:**
```bash
print_status "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞" "success"
print_status "–í–Ω–∏–º–∞–Ω–∏–µ: –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç" "warning"
```

#### log_message()
–ó–∞–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥ —Ñ–∞–π–ª.

```bash
log_message "message" "level" "log_file"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `message` - –¢–µ–∫—Å—Ç –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `level` - –£—Ä–æ–≤–µ–Ω—å: `INFO`, `WARNING`, `ERROR`, `DEBUG`
- `log_file` - –ü—É—Ç—å –∫ –ª–æ–≥ —Ñ–∞–π–ª—É

#### safe_execute()
–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ —Å —Ç–∞–π–º–∞—É—Ç–æ–º.

```bash
safe_execute "command" timeout_seconds
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `0` - –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- `1` - –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `124` - –¢–∞–π–º–∞—É—Ç

#### check_root()
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ root.

```bash
check_root
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `0` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ root
- `1` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤

#### check_system_requirements()
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

```bash
check_system_requirements
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- –î–æ—Å—Ç—É–ø–Ω—É—é –ø–∞–º—è—Ç—å
- –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
- –°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

## ü§ñ Telegram Bot API

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### /start
–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é.

```python
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE)
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "ü§ñ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VPN Server Bot!",
  "keyboard": ["üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", "‚öôÔ∏è –°–µ—Ä–≤–µ—Ä", "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"]
}
```

#### /adduser
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VPN.

```python
async def add_user_command(update: Update, context: ContextTypes.DEFAULT_TYPE)
```

**–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã:**
```
/adduser <–∏–º—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è> [limit:<–ª–∏–º–∏—Ç>] [expire:<—Å—Ä–æ–∫>]
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```
/adduser john_doe
/adduser alex limit:10GB
/adduser maria expire:30d
/adduser test limit:5GB expire:7d
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "john_doe",
  "created": "2025-09-19T15:30:25Z",
  "status": "active",
  "config_ready": true
}
```

#### /deleteuser
–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```python
async def delete_user_command(update: Update, context: ContextTypes.DEFAULT_TYPE)
```

**–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã:**
```
/deleteuser <uuid>
```

#### /listusers
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

```python
async def list_users_command(update: Update, context: ContextTypes.DEFAULT_TYPE)
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "users": [
    {
      "uuid": "550e8400-e29b-41d4-a716-446655440000",
      "name": "john_doe",
      "created": "2025-09-19T15:30:25Z",
      "status": "active",
      "last_connection": "2025-09-19T18:45:12Z",
      "traffic_used": "2.5GB"
    }
  ],
  "total": 1
}
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### /status
–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤.

```python
async def status_command(update: Update, context: ContextTypes.DEFAULT_TYPE)
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "server": {
    "uptime": "15 days 8 hours",
    "cpu_usage": "12%",
    "memory_usage": "30%",
    "disk_usage": "42.5%"
  },
  "services": {
    "xray_core": "running",
    "telegram_bot": "running",
    "monitoring": "running"
  },
  "network": {
    "active_connections": 8,
    "total_traffic": "245GB"
  }
}
```

#### /restart
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ VPN —Å–µ—Ä–≤–µ—Ä–∞.

```python
async def restart_command(update: Update, context: ContextTypes.DEFAULT_TYPE)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ù–µ—Ç

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Xray –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. –û—Ç—á–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ

### –§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

#### generate_qr_code()
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

```python
def generate_qr_code(vless_url: str) -> bytes
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `vless_url` - VLESS URL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ë–∞–π—Ç—ã PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

#### create_user_config()
–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```python
def create_user_config(user_uuid: str, user_name: str) -> dict
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "vless_url": "vless://uuid@domain:443?type=tcp&security=reality...",
  "config_file": "/path/to/user_config.json",
  "qr_code": "/path/to/qr_code.png"
}
```

#### send_security_alert()
–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

```python
async def send_security_alert(message: str, alert_type: str = "warning")
```

## üë• –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### user_management.sh

#### add_user()
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VPN.

```bash
add_user "username" [options]
```

**–û–ø—Ü–∏–∏:**
- `--limit <—Ä–∞–∑–º–µ—Ä>` - –õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 10GB)
- `--expire <–≤—Ä–µ–º—è>` - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 30d)
- `--no-config` - –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ü—Ä–∏–º–µ—Ä:**
```bash
./modules/user_management.sh add "john_doe" --limit 5GB --expire 30d
```

#### remove_user()
–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```bash
remove_user "user_uuid"
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ Xray –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞

#### list_users()
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

```bash
list_users [format]
```

**–§–æ—Ä–º–∞—Ç—ã:**
- `json` - JSON —Ñ–æ—Ä–º–∞—Ç
- `table` - –¢–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- `csv` - CSV —Ñ–æ—Ä–º–∞—Ç

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ (JSON):**
```json
{
  "users": [
    {
      "uuid": "550e8400-e29b-41d4-a716-446655440000",
      "name": "john_doe",
      "created": "2025-09-19 15:30:25",
      "status": "active",
      "traffic_limit": "5GB",
      "traffic_used": "1.2GB",
      "expires": "2025-10-19 15:30:25"
    }
  ]
}
```

#### get_user_config()
–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```bash
get_user_config "user_uuid" [format]
```

**–§–æ—Ä–º–∞—Ç—ã:**
- `vless` - VLESS URL
- `json` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª JSON
- `qr` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞

#### get_user_stats()
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```bash
get_user_stats "user_uuid"
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "upload_traffic": "856MB",
  "download_traffic": "1.2GB",
  "total_traffic": "2.056GB",
  "connection_count": 15,
  "last_connection": "2025-09-19 18:45:12",
  "online_time": "15h 23m"
}
```

## üîí –ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏

### cert_management.sh

#### generate_certificates()
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–ª—é—á–µ–π.

```bash
generate_certificates [options]
```

**–û–ø—Ü–∏–∏:**
- `--force` - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- `--backup` - –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- `--domain <–¥–æ–º–µ–Ω>` - –£–∫–∞–∑–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞

#### generate_reality_keys()
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–ª—è Reality –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

```bash
generate_reality_keys
```

**–°–æ–∑–¥–∞–µ—Ç:**
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á Reality
- –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á Reality
- Short ID –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏

#### update_reality_config()
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Reality.

```bash
update_reality_config --target <—Å–∞–π—Ç> --sni <sni_name>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `target` - –¶–µ–ª–µ–≤–æ–π —Å–∞–π—Ç –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ (microsoft.com, apple.com)
- `sni` - SNI –∏–º—è –¥–ª—è TLS

#### verify_certificates()
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

```bash
verify_certificates
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–º–µ–Ω—É

## üìä –ú–æ–¥—É–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### monitoring.sh

#### get_system_status()
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã.

```bash
get_system_status [format]
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "cpu": {
    "usage": "12.5%",
    "load_average": [0.85, 0.92, 1.05],
    "cores": 2
  },
  "memory": {
    "total": "4GB",
    "used": "1.2GB",
    "usage": "30%",
    "swap_used": "0MB"
  },
  "disk": {
    "total": "20GB",
    "used": "8.5GB",
    "usage": "42.5%",
    "available": "11.5GB"
  },
  "network": {
    "rx_bytes": "156GB",
    "tx_bytes": "89GB",
    "active_connections": 8
  }
}
```

#### get_service_status()
–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤.

```bash
get_service_status [service_name]
```

**–°–µ—Ä–≤–∏—Å—ã:**
- `vless-vpn` - –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- `xray-core` - Xray –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- `telegram-bot` - Telegram –±–æ—Ç
- `monitoring` - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### get_performance_metrics()
–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

```bash
get_performance_metrics
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "bandwidth": {
    "current": "45 Mbps",
    "max": "892 Mbps",
    "average_1h": "78 Mbps"
  },
  "connections": {
    "total": 1245,
    "active": 8,
    "max_concurrent": 50
  },
  "latency": {
    "average": "15ms",
    "min": "8ms",
    "max": "45ms"
  }
}
```

#### check_security_status()
–°—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

```bash
check_security_status
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°—Ç–∞—Ç—É—Å UFW —Ñ–∞–π—Ä–≤–æ–ª–ª–∞
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å fail2ban
- –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ (AIDE)
- –ê–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

## üíæ –ú–æ–¥—É–ª—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

### backup_restore.sh

#### create_backup()
–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏.

```bash
create_backup [options]
```

**–û–ø—Ü–∏–∏:**
- `--full` - –ü–æ–ª–Ω–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
- `--config-only` - –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `--users-only` - –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `--compress` - –°–∂–∞—Ç–∏–µ –∞—Ä—Ö–∏–≤–∞
- `--encrypt` - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

#### restore_backup()
–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏.

```bash
restore_backup <backup_file> [options]
```

**–û–ø—Ü–∏–∏:**
- `--verify` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- `--test` - –¢–µ—Å—Ç–æ–≤–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- `--force` - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

#### list_backups()
–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π.

```bash
list_backups [format]
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "backups": [
    {
      "filename": "vless-backup-20250919-203045.tar.gz",
      "size": "15.8MB",
      "created": "2025-09-19 20:30:45",
      "type": "full",
      "users_count": 15,
      "integrity": "verified"
    }
  ]
}
```

#### verify_backup()
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏.

```bash
verify_backup <backup_file>
```

## üõ°Ô∏è –ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### security_hardening.sh

#### setup_fail2ban()
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫.

```bash
setup_fail2ban [options]
```

**–û–ø—Ü–∏–∏:**
- `--ban-time <–≤—Ä–µ–º—è>` - –í—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1h)
- `--max-retry <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ>` - –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3)
- `--whitelist <ip>` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ IP –≤ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫

#### setup_aide()
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ AIDE –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏.

```bash
setup_aide
```

**–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –∫–ª—é—á–∏

#### audit_system()
–ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

```bash
audit_system
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã
- –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–ª—É–∂–±—ã
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

## üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Xray –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### config.json
–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Xray —Å–µ—Ä–≤–µ—Ä–∞.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/opt/vless/configs/config.json`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "log": {
    "level": "info",
    "dnsLog": false
  },
  "inbounds": [
    {
      "port": 443,
      "protocol": "vless",
      "settings": {
        "clients": [],
        "decryption": "none"
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "dest": "microsoft.com:443",
          "serverNames": ["www.microsoft.com"],
          "privateKey": "PRIVATE_KEY",
          "shortIds": ["SHORT_ID"]
        }
      }
    }
  ],
  "outbounds": [
    {
      "protocol": "freedom",
      "tag": "direct"
    }
  ]
}
```

### Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### docker-compose.yml
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker —Å–µ—Ä–≤–∏—Å–æ–≤.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/opt/vless/docker-compose.yml`

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- `xray-core` - VPN —Å–µ—Ä–≤–µ—Ä
- `telegram-bot` - Telegram –±–æ—Ç
- `monitoring` - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### Telegram Bot –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### .env
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±–æ—Ç–∞.

```env
BOT_TOKEN=your_bot_token
ADMIN_TELEGRAM_ID=your_admin_id
DOMAIN=your-domain.com
VLESS_PORT=443
HTTP_PORT=80
```

## üåê API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### REST API (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

#### GET /api/v1/status
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞.

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "running",
  "uptime": "15d 8h 23m",
  "version": "1.0.0",
  "users_count": 15,
  "active_connections": 8
}
```

#### GET /api/v1/users
–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- `offset` - –°–º–µ—â–µ–Ω–∏–µ
- `status` - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É

#### POST /api/v1/users
–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "name": "john_doe",
  "limit": "5GB",
  "expire": "30d"
}
```

#### DELETE /api/v1/users/{uuid}
–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### GET /api/v1/users/{uuid}/config
–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### WebSocket API

#### /ws/monitoring
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–°–æ–±—ã—Ç–∏—è:**
- `status_update` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- `new_connection` - –ù–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- `security_alert` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üîß –£—Ç–∏–ª–∏—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### debug_mode()
–í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏.

```bash
export DEBUG=1
./modules/user_management.sh add "test"
```

#### validate_config()
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

```bash
validate_config /opt/vless/configs/config.json
```

#### run_tests()
–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –º–æ–¥—É–ª—è.

```bash
run_tests user_management
run_tests cert_management
run_tests telegram_bot
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `DEBUG` - –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `INFO` - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `WARNING` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `ERROR` - –û—à–∏–±–∫–∏
- `CRITICAL` - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

#### –§–∞–π–ª—ã –ª–æ–≥–æ–≤
```
/opt/vless/logs/
‚îú‚îÄ‚îÄ xray.log              # –õ–æ–≥–∏ Xray —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ telegram_bot.log      # –õ–æ–≥–∏ Telegram –±–æ—Ç–∞
‚îú‚îÄ‚îÄ system.log            # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
‚îú‚îÄ‚îÄ security.log          # –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ monitoring.log        # –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îî‚îÄ‚îÄ backup.log            # –õ–æ–≥–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
VLESS_HOME=/opt/vless
VLESS_CONFIG_DIR=${VLESS_HOME}/configs
VLESS_CERTS_DIR=${VLESS_HOME}/certs
VLESS_USERS_DIR=${VLESS_HOME}/users
VLESS_LOGS_DIR=${VLESS_HOME}/logs
VLESS_BACKUPS_DIR=${VLESS_HOME}/backups
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
DEBUG=1                   # –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
VLESS_TEST_MODE=1        # –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
VLESS_LOG_LEVEL=DEBUG    # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: [Security Guide](security_guide.md)