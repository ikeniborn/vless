# План разработки VLESS+Reality VPN сервиса

## Выбранный вариант: Минималистичный (Quick Start)

### Параметры проекта
- **Количество пользователей:** до 10
- **Интерфейс:** CLI only
- **Интеграции:** нет
- **Логирование:** минимальное
- **Платформа:** Linux (Debian/Ubuntu)

## Структура проекта

```
vless/
├── vless-manager.sh      # Главный управляющий скрипт
├── docker-compose.yml    # Конфигурация Docker контейнера
├── config/
│   ├── server.json       # Серверная конфигурация Xray
│   └── users/            # Клиентские конфигурации
├── data/
│   ├── users.db          # База пользователей (текстовый файл)
│   └── keys/             # Хранилище ключей
└── logs/
    └── xray.log          # Логи сервиса
```

## Этапы разработки

### ✅ Этап 1: Базовая инфраструктура (ЗАВЕРШЕН)
**Задачи:**
1. ✅ Создание главного скрипта `vless-manager.sh`
2. ✅ Реализация проверки системных требований
3. ✅ Функция установки Docker и Docker Compose
4. ✅ Создание структуры директорий

**Файлы:**
- ✅ `vless-manager.sh` - основной скрипт
- ✅ `.env` - переменные окружения

**Результаты:**
- Скрипт полностью функционален с командой `install`
- Все системные проверки реализованы
- Автоматическая установка Docker/Docker Compose
- Структура директорий создана с правильными правами доступа
- Написаны comprehensive тесты
- Обновлена документация (README.md, CLAUDE.md)

### ✅ Этап 2: Генерация конфигураций (ЗАВЕРШЕН)
**Задачи:**
1. ✅ Генерация X25519 ключей (privateKey/publicKey)
2. ✅ Генерация UUID для пользователей
3. ✅ Создание базовой конфигурации Xray сервера
4. ✅ Шаблон docker-compose.yml

**Функции:**
- ✅ `generate_keys()` - генерация ключевой пары
- ✅ `generate_uuid()` - создание UUID
- ✅ `generate_short_id()` - генерация shortId
- ✅ `create_server_config()` - формирование server.json
- ✅ `create_docker_compose()` - создание docker-compose.yml

**Результаты:**
- Все функции генерации конфигураций реализованы
- Интеграция в процесс установки (шаги 6-8)
- Написаны комплексные тесты
- Обновлена документация

### ✅ Этап 3: Управление пользователями (ЗАВЕРШЕН)
**Задачи:**
1. ✅ Добавление новых пользователей
2. ✅ Удаление пользователей
3. ✅ Список активных пользователей
4. ✅ Генерация клиентских конфигураций

**Функции:**
- ✅ `add_user()` - добавление пользователя
- ✅ `remove_user()` - удаление пользователя
- ✅ `list_users()` - вывод списка
- ✅ `show_user()` - детальная информация о пользователе
- ✅ `generate_client_config()` - создание конфига для клиента
- ✅ `validate_username()` - валидация имени пользователя
- ✅ `user_exists()` - проверка существования пользователя
- ✅ `update_server_config()` - обновление конфигурации сервера

**Результаты:**
- Все функции управления пользователями реализованы
- База данных пользователей с форматом username:uuid:shortId:created_date:status
- Автоматическое обновление server.json при добавлении/удалении
- Генерация VLESS URL и JSON конфигураций
- Лимит 10 пользователей с валидацией
- Написаны комплексные тесты (52 теста)
- Обновлена документация

### ✅ Этап 4: Docker интеграция (ЗАВЕРШЕН)
**Задачи:**
1. ✅ Создание docker-compose.yml
2. ✅ Настройка автозапуска контейнера
3. ✅ Проброс портов и volumes
4. ✅ Health checks

**Функции:**
- ✅ `check_docker_available()` - проверка доступности Docker
- ✅ `start_service()` - запуск сервиса
- ✅ `stop_service()` - остановка сервиса
- ✅ `restart_service()` - перезапуск
- ✅ `check_service_status()` - проверка статуса
- ✅ `view_logs()` - просмотр логов
- ✅ `container_health_check()` - проверка здоровья контейнера

**Результаты:**
- Все функции Docker управления реализованы
- CLI команды интегрированы (start, stop, restart, status, logs)
- Docker Compose файл создается при установке
- Написаны комплексные тесты (40+ тестов)
- Обновлена документация

### Этап 5: Сервисные функции
**Задачи:**
1. Проверка статуса сервиса
2. Перезапуск сервиса
3. Просмотр логов
4. Деинсталляция

**Функции:**
- `status()` - статус контейнера
- `restart()` - перезапуск
- `logs()` - вывод логов
- `uninstall()` - полное удаление

### Этап 6: Тестирование и документация
**Задачи:**
1. Тестирование установки на чистой системе
2. Проверка всех функций управления
3. Создание README.md с инструкциями
4. Примеры использования

## Команды скрипта

```bash
# Установка
./vless-manager.sh install

# Добавление пользователя
./vless-manager.sh add-user <username>

# Удаление пользователя
./vless-manager.sh remove-user <username>

# Список пользователей
./vless-manager.sh list-users

# Статус сервиса
./vless-manager.sh status

# Перезапуск
./vless-manager.sh restart

# Логи
./vless-manager.sh logs

# Удаление
./vless-manager.sh uninstall
```

## Технические детали

### Серверная конфигурация
```json
{
  "log": {
    "loglevel": "warning"
  },
  "inbounds": [{
    "port": 443,
    "protocol": "vless",
    "settings": {
      "clients": [],
      "decryption": "none"
    },
    "streamSettings": {
      "network": "tcp",
      "security": "reality",
      "realitySettings": {
        "dest": "speed.cloudflare.com:443",
        "serverNames": ["speed.cloudflare.com"],
        "privateKey": "",
        "shortIds": [""]
      }
    }
  }],
  "outbounds": [{
    "protocol": "freedom"
  }]
}
```

### Формат хранения пользователей
```
username:uuid:shortId:created_date:status
john_doe:550e8400-e29b-41d4-a716-446655440000:a1b2c3:2025-01-25:active
```

## Требования к системе

- **ОС:** Ubuntu 20.04+ / Debian 11+
- **Архитектура:** x86_64 / ARM64
- **RAM:** минимум 512 MB
- **Disk:** минимум 1 GB свободного места
- **Сеть:** открытый порт 443
- **Права:** root или sudo

## Безопасность

1. Хранение ключей с правами 600
2. Конфигурации доступны только root
3. Автоматическая ротация shortIds
4. Минимальное логирование (только ошибки)
5. Проверка целостности конфигураций

## Временные оценки

| Этап | Время разработки | Приоритет |
|------|------------------|-----------|
| Этап 1: Инфраструктура | 2-3 часа | Высокий |
| Этап 2: Генерация конфигов | 3-4 часа | Высокий |
| Этап 3: Управление пользователями | 4-5 часов | Высокий |
| Этап 4: Docker интеграция | 2-3 часа | Высокий |
| Этап 5: Сервисные функции | 2 часа | Средний |
| Этап 6: Тестирование | 3-4 часа | Высокий |

**Общее время:** 16-21 час (2-3 рабочих дня)

## Дальнейшее развитие

После успешной реализации базового функционала можно добавить:
- Backup/restore конфигураций
- Автообновление Xray
- Мониторинг трафика пользователей
- Поддержка множественных серверов
- Telegram уведомления о событиях